From d43d8af650ee9ed175ebd4fdfc15ac2767734a8d Mon Sep 17 00:00:00 2001
From: Fabian Herschel <fabian.herschel@suse.com>
Date: Wed, 25 Jul 2018 12:30:32 +0200
Subject: [PATCH] ra/SAPHanaTopology: bsc#1016691 "SAPHanaSR: Status file of
 SAPHanaTopology is not multi instance aware (MCOS)"

---
 SAPHana/ra/SAPHanaTopology | 20 +++++++++++---------
 1 file changed, 11 insertions(+), 9 deletions(-)

diff --git a/SAPHanaSR-2067519/SAPHana/ra/SAPHanaTopology b/SAPHanaSR-2067519/SAPHana/ra/SAPHanaTopology
index 1e2f301..20d2593 100755
--- a/SAPHanaSR-2067519/SAPHana/ra/SAPHanaTopology
+++ b/SAPHanaSR-2067519/SAPHana/ra/SAPHanaTopology
@@ -28,7 +28,7 @@
 #######################################################################
 #
 # Initialization:
-SAPHanaVersion="0.152.21"
+SAPHanaVersion="0.152.22"
 timeB=$(date '+%s')
 
 : ${OCF_FUNCTIONS_DIR=${OCF_ROOT}/lib/heartbeat}
@@ -736,15 +736,17 @@ function sht_start() {
 # sht_stop: Stop the SAP HANA Topology Resource
 #
 function sht_stop() {
-  super_ocf_log info "FLOW $FUNCNAME ($*)"
-  local output=""
-  local rc=0
-
-  rm $HA_RSCTMP/SAPHana/SAPTopologyON.${SID}
-  rc=$OCF_SUCCESS
+    super_ocf_log info "FLOW $FUNCNAME ($*)"
+    local output=""
+    local rc=0
+    if [ -f $HA_RSCTMP/SAPHana/SAPTopologyON ]; then
+        rm $HA_RSCTMP/SAPHana/SAPTopologyON
+    fi
+    rm $HA_RSCTMP/SAPHana/SAPTopologyON.${SID}
+    rc=$OCF_SUCCESS
 
-  super_ocf_log info "FLOW $FUNCNAME rc=$rc"
-  return $rc
+    super_ocf_log info "FLOW $FUNCNAME rc=$rc"
+    return $rc
 }
 
 
