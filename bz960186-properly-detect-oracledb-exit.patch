From 6b6b7dad32fcf35e87e56b693c4c2e86d06a0684 Mon Sep 17 00:00:00 2001
From: David Vossel <dvossel@redhat.com>
Date: Fri, 30 May 2014 15:43:42 -0500
Subject: [PATCH 3/4] Low: oracledb.sh: Fix exit_idle loop to exit process wait
 loop correctly

---
 rgmanager/src/resources/oracledb.sh | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/rgmanager/src/resources/oracledb.sh b/rgmanager/src/resources/oracledb.sh
index 3ccc47a..cdd2c9a 100644
--- a/rgmanager/src/resources/oracledb.sh
+++ b/rgmanager/src/resources/oracledb.sh
@@ -388,7 +388,8 @@ exit_idle()
 	declare -i n=0
 
 	ocf_log debug "Waiting for Oracle processes for $ORACLE_SID to terminate..."
-	while ps ax | grep $ORACLE_HOME | grep "ora_.*_${ORACLE_SID}" | grep -v grep | awk '{print $1}'; do
+	# grep -q "." keeps this loop going if the previous commands produce any stdout
+	while ps ax | grep $ORACLE_HOME | grep "ora_.*_${ORACLE_SID}" | grep -v grep | awk '{print $1}' | grep -q "."; do
 		if [ $n -ge 90 ]; then
 			ocf_log debug "Timed out while waiting for Oracle processes for $ORACLE_SID to terminate"
 			force_cleanup
-- 
1.8.4.2

